<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emblem Vault SDK Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --error-color: #e74c3c;
            --background-color: #f8f9fa;
            font-size: 14px;
        }

        .container {
            max-width: 100% !important;
            padding: 0.5rem !important;
        }

        /* Grid container */
        .resizable-grid {
            display: flex;
            height: calc(100vh - 80px);
            gap: 0;
            padding: 0.5rem;
            position: relative;
        }

        /* Grid panels */
        .panel {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            min-width: 200px;
            position: relative;
        }

        .panel-header {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .panel-content {
            flex: 1;
            overflow: auto;
            padding: 0.75rem;
        }

        /* Resizer */
        .resizer {
            width: 8px;
            cursor: col-resize;
            padding: 0 2px;
            background-color: transparent;
            transition: background-color 0.2s;
        }

        .resizer:hover,
        .resizer.resizing {
            background-color: var(--primary-color);
        }

        .resizer::after {
            content: '';
            display: block;
            width: 2px;
            height: 100%;
            background: #e5e7eb;
            margin: 0 auto;
            transition: background-color 0.2s;
        }

        .resizer:hover::after,
        .resizer.resizing::after {
            background: var(--primary-color);
        }

        /* Existing styles */
        .method-list {
            max-height: 100%;
            overflow-y: auto;
        }

        .method-card {
            transition: all 0.2s ease;
            background-color: white;
            border: 1px solid #e1e1e1;
            border-radius: 4px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .method-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .method-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .method-content {
            display: none;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e1e1e1;
        }

        .method-content.expanded {
            display: block;
        }

        .method-name {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .method-description {
            color: #666;
            font-size: 0.8rem;
            margin: 0.25rem 0;
            line-height: 1.3;
        }

        .method-params {
            margin: 0.5rem 0;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .method-return {
            color: #6c5ce7;
            font-family: monospace;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: block;
            padding: 2px 4px;
            background: #f8f9fa;
            border-radius: 3px;
            border: 1px solid #e9ecef;
        }

        .method-return::before {
            content: 'â†’';
            margin-right: 4px;
            color: #666;
        }

        .param-input {
            font-size: 0.8rem !important;
            padding: 0.25rem 0.5rem !important;
            width: 100%;
        }

        .param-type {
            color: #6c5ce7;
            font-size: 0.75rem;
        }

        .param-description {
            color: #666;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        /* Compact header */
        header {
            margin-bottom: 0.5rem !important;
            padding: 0.5rem !important;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 1.2rem !important;
            margin-bottom: 0.5rem !important;
        }

        /* Compact buttons */
        button {
            padding: 0.25rem 0.75rem !important;
            font-size: 0.8rem !important;
        }

        /* User select none during resize */
        .resizing * {
            user-select: none !important;
        }

        /* Web3 connection status */
        .web3-connected #web3Status {
            background-color: #10b981;
        }

        #web3Details {
            transform-origin: top right;
            transition: all 0.2s ease;
        }

        #web3Details.show {
            display: block;
            animation: popIn 0.2s ease;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Click outside handler overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 40;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto">
        <header>
            <h1 class="font-bold text-gray-800">Emblem Vault SDK Explorer</h1>
            <div class="flex space-x-2">
                <input type="text" id="apiKey" placeholder="Enter API Key" class="flex-1 border rounded param-input" />
                <button id="connectSDK" class="bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">Connect SDK</button>
                <div class="relative">
                    <button id="connectWeb3" class="bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors flex items-center px-3 py-1">
                        <span id="web3Status" class="w-2 h-2 rounded-full bg-gray-400 mr-2"></span>
                        <span id="web3Text">Connect Web3</span>
                    </button>
                    <div id="web3Details" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg p-3 z-50 text-sm">
                        <div class="mb-2">
                            <div class="font-semibold text-gray-700">Network</div>
                            <div id="web3Network" class="text-gray-600">-</div>
                        </div>
                        <div class="mb-2">
                            <div class="font-semibold text-gray-700">Account</div>
                            <div id="web3Account" class="text-gray-600 truncate">-</div>
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700">Balance</div>
                            <div id="web3Balance" class="text-gray-600">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="resizable-grid">
            <!-- Methods Panel -->
            <div class="panel" style="flex: 1">
                <div class="panel-header">Methods</div>
                <div class="panel-content">
                    <input type="text" id="methodSearch" placeholder="Search methods..." class="w-full border rounded param-input mb-2" />
                    <div id="methodList" class="method-list"></div>
                </div>
            </div>

            <!-- Resizer -->
            <div class="resizer" data-index="0"></div>

            <!-- Parameters Panel -->
            <div class="panel" style="flex: 1">
                <div class="panel-header">Parameters</div>
                <div class="panel-content">
                    <div id="parameterForm" class="space-y-2">
                        <p class="text-gray-500 text-xs">Select a method to view parameters</p>
                    </div>
                    <button id="executeMethod" class="mt-2 w-full bg-green-500 text-white rounded hover:bg-green-600 transition-colors" disabled>Execute Method</button>
                </div>
            </div>

            <!-- Resizer -->
            <div class="resizer" data-index="1"></div>

            <!-- Results Panel -->
            <div class="panel" style="flex: 1">
                <div class="panel-header">Results</div>
                <div class="panel-content">
                    <div id="resultPanel" class="bg-gray-50 p-2 rounded min-h-[100px] mb-2 text-xs">
                        <div class="text-gray-500">Execute a method to see results</div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="copyResult" class="flex-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            Copy
                        </button>
                        <button id="clearResults" class="flex-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-json.min.js"></script>
    <script src="/dist/bundle.js"></script>
    <script src="./sdk-explorer.js"></script>
    <script>
        // Add expander functionality
        document.addEventListener('click', (e) => {
            if (e.target.closest('.method-header')) {
                const card = e.target.closest('.method-card');
                const content = card.querySelector('.method-content');
                const expander = card.querySelector('.expander');
                content.classList.toggle('expanded');
                expander.classList.toggle('expanded');
            }
        });

        // Resizer functionality
        document.addEventListener('DOMContentLoaded', () => {
            const resizers = document.querySelectorAll('.resizer');
            let currentResizer = null;
            let prevSibling = null;
            let nextSibling = null;
            let prevWidth = 0;
            let nextWidth = 0;
            let startX = 0;

            function initResize(e) {
                currentResizer = e.target;
                prevSibling = currentResizer.previousElementSibling;
                nextSibling = currentResizer.nextElementSibling;
                startX = e.pageX;
                prevWidth = prevSibling.offsetWidth;
                nextWidth = nextSibling.offsetWidth;

                // Add resizing class
                document.body.classList.add('resizing');
                currentResizer.classList.add('resizing');

                // Add event listeners
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stopResize);
            }

            function resize(e) {
                if (!currentResizer) return;

                const diff = e.pageX - startX;
                const newPrevWidth = Math.max(200, prevWidth + diff);
                const newNextWidth = Math.max(200, nextWidth - diff);

                prevSibling.style.flex = 'none';
                nextSibling.style.flex = 'none';
                prevSibling.style.width = newPrevWidth + 'px';
                nextSibling.style.width = newNextWidth + 'px';

                // Save panel sizes
                const panelSizes = {};
                document.querySelectorAll('.panel').forEach((panel, index) => {
                    panelSizes[index] = panel.offsetWidth;
                });
                localStorage.setItem('sdkExplorer_panelSizes', JSON.stringify(panelSizes));
            }

            function stopResize() {
                if (!currentResizer) return;

                // Remove resizing class
                document.body.classList.remove('resizing');
                currentResizer.classList.remove('resizing');

                // Remove event listeners
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);

                currentResizer = null;
            }

            resizers.forEach(resizer => {
                resizer.addEventListener('mousedown', initResize);
            });

            // Load saved panel sizes
            try {
                const panelSizes = JSON.parse(localStorage.getItem('sdkExplorer_panelSizes') || '{}');
                if (panelSizes) {
                    document.querySelectorAll('.panel').forEach((panel, index) => {
                        if (panelSizes[index]) {
                            panel.style.flex = 'none';
                            panel.style.width = panelSizes[index] + 'px';
                        }
                    });
                }
            } catch (e) {
                console.warn('Failed to load panel sizes:', e);
            }
        });

        // Add Web3 connection status to window
        window.web3Connected = false;

        async function updateWeb3Details() {
            if (!window.ethereum || !window.web3Connected) return;

            try {
                // Get network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const networkNames = {
                    '0x1': 'Ethereum Mainnet',
                    '0x5': 'Goerli Testnet',
                    '0x89': 'Polygon',
                    '0x13881': 'Mumbai Testnet'
                };
                const networkName = networkNames[chainId] || `Chain ${chainId}`;
                document.getElementById('web3Network').textContent = networkName;

                // Get account
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts[0]) {
                    const shortenedAccount = accounts[0].slice(0, 6) + '...' + accounts[0].slice(-4);
                    document.getElementById('web3Account').textContent = shortenedAccount;
                    document.getElementById('web3Account').title = accounts[0];

                    // Get balance
                    const balance = await window.ethereum.request({
                        method: 'eth_getBalance',
                        params: [accounts[0], 'latest']
                    });
                    const ethBalance = parseInt(balance, 16) / 1e18;
                    document.getElementById('web3Balance').textContent = `${ethBalance.toFixed(4)} ETH`;
                }
            } catch (error) {
                console.error('Error updating Web3 details:', error);
            }
        }

        async function connectWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });

                    // Update UI
                    document.body.classList.add('web3-connected');
                    window.web3Connected = true;
                    document.getElementById('web3Text').textContent = 'Web3 Connected';

                    // Update details
                    await updateWeb3Details();

                    // Save connection state
                    localStorage.setItem('sdkExplorer_web3Connected', 'true');

                    // Listen for account changes
                    window.ethereum.on('accountsChanged', function (accounts) {
                        if (accounts.length === 0) {
                            disconnectWeb3();
                        } else {
                            updateWeb3Details();
                        }
                    });

                    // Listen for chain changes
                    window.ethereum.on('chainChanged', function () {
                        updateWeb3Details();
                    });
                } catch (error) {
                    console.error('User rejected Web3 connection');
                }
            } else {
                alert('Please install MetaMask or another Web3 provider');
            }
        }

        function disconnectWeb3() {
            document.body.classList.remove('web3-connected');
            window.web3Connected = false;
            document.getElementById('web3Text').textContent = 'Connect Web3';
            localStorage.removeItem('sdkExplorer_web3Connected');

            // Reset details
            document.getElementById('web3Network').textContent = '-';
            document.getElementById('web3Account').textContent = '-';
            document.getElementById('web3Balance').textContent = '-';
        }

        // Handle Web3 details popup
        document.addEventListener('DOMContentLoaded', () => {
            const web3Button = document.getElementById('connectWeb3');
            const web3Details = document.getElementById('web3Details');

            web3Button.addEventListener('click', async (e) => {
                if (!window.web3Connected) {
                    await connectWeb3();
                } else {
                    // Toggle details
                    const isShowing = web3Details.classList.contains('show');
                    if (!isShowing) {
                        web3Details.classList.add('show');
                        // Add overlay
                        const overlay = document.createElement('div');
                        overlay.className = 'overlay';
                        overlay.addEventListener('click', () => {
                            web3Details.classList.remove('show');
                            overlay.remove();
                        });
                        document.body.appendChild(overlay);
                    }
                }
            });

            // Check saved connection state
            if (localStorage.getItem('sdkExplorer_web3Connected') === 'true') {
                connectWeb3();
            }
        });
    </script>
</body>
</html>
